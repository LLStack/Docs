<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>启用 WAF 规则 | LLStack</title>
    <meta name="description" content="LLStack - 基于(Open)LiteSpeed的一站式高性能PHP网站解决方案/一键包，这是一款提供便捷、纯粹的 (Open)LiteSpeed+PHP+MySQL 运行环境的一键包。">
    <meta name="generator" content="VuePress 1.3.0">
    
    <meta property="og:site_name" content="LLStack"><meta property="og:title" content="启用 WAF 规则"><meta property="og:type" content="website"><meta property="og:url" content="/lsws/LiteSpeed/waf.html"><meta name="twitter:title" content="启用 WAF 规则"><meta name="twitter:url" content="/lsws/LiteSpeed/waf.html"><meta name="twitter:card" content="summary_large_image">
    <link rel="preload" href="/assets/css/0.styles.2cd38edf.css" as="style"><link rel="preload" href="/assets/js/app.a453011c.js" as="script"><link rel="preload" href="/assets/js/2.25f4805c.js" as="script"><link rel="preload" href="/assets/js/13.d814101e.js" as="script"><link rel="preload" href="/assets/js/3.a091ac96.js" as="script"><link rel="prefetch" href="/assets/js/10.2d50d411.js"><link rel="prefetch" href="/assets/js/11.6d388fbf.js"><link rel="prefetch" href="/assets/js/12.fac933d0.js"><link rel="prefetch" href="/assets/js/14.7b33a2eb.js"><link rel="prefetch" href="/assets/js/15.14cea6b4.js"><link rel="prefetch" href="/assets/js/16.340aad1b.js"><link rel="prefetch" href="/assets/js/17.a20723ba.js"><link rel="prefetch" href="/assets/js/18.f57d8763.js"><link rel="prefetch" href="/assets/js/19.c67a6399.js"><link rel="prefetch" href="/assets/js/20.53ed802f.js"><link rel="prefetch" href="/assets/js/21.ab1b9cff.js"><link rel="prefetch" href="/assets/js/22.73d55546.js"><link rel="prefetch" href="/assets/js/23.cb687969.js"><link rel="prefetch" href="/assets/js/24.cf1bbc9f.js"><link rel="prefetch" href="/assets/js/25.bce64921.js"><link rel="prefetch" href="/assets/js/26.244f6f63.js"><link rel="prefetch" href="/assets/js/27.8da6a08a.js"><link rel="prefetch" href="/assets/js/28.7e08cc2c.js"><link rel="prefetch" href="/assets/js/29.91b38d56.js"><link rel="prefetch" href="/assets/js/30.85a145be.js"><link rel="prefetch" href="/assets/js/31.0bc49440.js"><link rel="prefetch" href="/assets/js/32.4561f71a.js"><link rel="prefetch" href="/assets/js/33.fa23f891.js"><link rel="prefetch" href="/assets/js/34.caa69819.js"><link rel="prefetch" href="/assets/js/35.b3fd7090.js"><link rel="prefetch" href="/assets/js/36.9804a01f.js"><link rel="prefetch" href="/assets/js/37.376cd81a.js"><link rel="prefetch" href="/assets/js/4.c68e79bd.js"><link rel="prefetch" href="/assets/js/5.351f1ee0.js"><link rel="prefetch" href="/assets/js/6.8d32e322.js"><link rel="prefetch" href="/assets/js/7.7c92cc73.js"><link rel="prefetch" href="/assets/js/8.59769d2e.js"><link rel="prefetch" href="/assets/js/9.2d97bbea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2cd38edf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">LLStack</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安装" class="dropdown-title"><span class="title">安装</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ols/" class="nav-link">
  OLStack
</a></li><li class="dropdown-item"><!----> <a href="/lsws/install/" class="nav-link">
  LLStack
</a></li></ul></div></div><div class="nav-item"><a href="/vhost/" class="nav-link">
  虚拟主机管理
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="OLS组件管理" class="dropdown-title"><span class="title">OLS组件管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ols/openlitespeed/" class="nav-link">
  OpenLiteSpeed
</a></li><li class="dropdown-item"><!----> <a href="/ols/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/ols/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/ols/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LSWS组件管理" class="dropdown-title"><span class="title">LSWS组件管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lsws/LiteSpeed/" class="nav-link router-link-active">
  LiteSpeed
</a></li><li class="dropdown-item"><!----> <a href="/lsws/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/lsws/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/lsws/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他设置" class="dropdown-title"><span class="title">其他设置</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/firewall.html" class="nav-link">
  防火墙
</a></li><li class="dropdown-item"><!----> <a href="/others/Security-group.html" class="nav-link">
  安全组
</a></li><li class="dropdown-item"><!----> <a href="/others/fdisk.html" class="nav-link">
  磁盘挂载
</a></li></ul></div></div><div class="nav-item"><a href="/old/v1/" class="nav-link">
  老版LSWS说明书
</a></div> <a href="https://github.com/LLStack" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="安装" class="dropdown-title"><span class="title">安装</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ols/" class="nav-link">
  OLStack
</a></li><li class="dropdown-item"><!----> <a href="/lsws/install/" class="nav-link">
  LLStack
</a></li></ul></div></div><div class="nav-item"><a href="/vhost/" class="nav-link">
  虚拟主机管理
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="OLS组件管理" class="dropdown-title"><span class="title">OLS组件管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ols/openlitespeed/" class="nav-link">
  OpenLiteSpeed
</a></li><li class="dropdown-item"><!----> <a href="/ols/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/ols/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/ols/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LSWS组件管理" class="dropdown-title"><span class="title">LSWS组件管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lsws/LiteSpeed/" class="nav-link router-link-active">
  LiteSpeed
</a></li><li class="dropdown-item"><!----> <a href="/lsws/php/" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/lsws/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/lsws/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他设置" class="dropdown-title"><span class="title">其他设置</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/firewall.html" class="nav-link">
  防火墙
</a></li><li class="dropdown-item"><!----> <a href="/others/Security-group.html" class="nav-link">
  安全组
</a></li><li class="dropdown-item"><!----> <a href="/others/fdisk.html" class="nav-link">
  磁盘挂载
</a></li></ul></div></div><div class="nav-item"><a href="/old/v1/" class="nav-link">
  老版LSWS说明书
</a></div> <a href="https://github.com/LLStack" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>激活</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lsws/LiteSpeed/Activation.html" class="sidebar-link">LiteSpeed 激活</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>WAF</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lsws/LiteSpeed/waf.html" class="active sidebar-link">启用 WAF 规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lsws/LiteSpeed/waf.html#下载和提取规则" class="sidebar-link">下载和提取规则</a></li><li class="sidebar-sub-header"><a href="/lsws/LiteSpeed/waf.html#添加waf规则集" class="sidebar-link">添加WAF规则集</a></li><li class="sidebar-sub-header"><a href="/lsws/LiteSpeed/waf.html#启用防火墙" class="sidebar-link">启用防火墙</a></li><li class="sidebar-sub-header"><a href="/lsws/LiteSpeed/waf.html#测试modsecurity规则集" class="sidebar-link">测试ModSecurity规则集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lsws/LiteSpeed/waf.html#方法1" class="sidebar-link">方法1</a></li><li class="sidebar-sub-header"><a href="/lsws/LiteSpeed/waf.html#方法2：" class="sidebar-link">方法2：</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="启用-waf-规则">启用 WAF 规则</h1> <p>在 LSWS Web Admin 控制台中，有一个**Web应用程序防火墙（WAF）**部分，它允许启用 Mod_Security 并在LSWS本机服务器上添加规则集。</p> <p>导航到  <strong>Server &gt; Security</strong></p> <p><img src="https://pics.mf8.biz/picgo20190225145731.png" alt=""></p> <p>在 <strong>Web Application Firewall (WAF)</strong> 部分中，您可以选择是否启用“ <strong>请求内容深度检查”</strong>。此功能等同于Apache的ModSecurity，它可用于通过将请求与已知签名进行匹配来检测和阻止具有恶意的请求。</p> <p>您可以选择许多规则集，例如：</p> <ul><li>OWASP</li> <li>Comodo</li> <li>Atomicorp</li> <li>Imunify360</li></ul> <p>LSWS 与这些规则集兼容，当然也支持其他的 Mod_Security 规则集，如果熟悉制作ModSecurity规则集，也可以定义自己的规则。</p> <p><strong>让我们看一下如何使用 Comodo 作为示例启用 Mod_Security 规则集。</strong></p> <p><a href="https://waf.comodo.com/" target="_blank" rel="noopener noreferrer">Comodo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是由Comodo团队创建的Mod_Security规则集。它为LiteSpeed Web Server上运行的Web应用程序提供实时保护。其功能包括：</p> <ul><li>保护敏感的客户数据</li> <li>满足PCI合规性要求</li> <li>阻止未经授权的访问</li> <li>防止SQL注入和跨站点脚本（XSS）攻击</li></ul> <h2 id="下载和提取规则">下载和提取规则</h2> <p>首先，下载与Litespeed兼容的Comodo规则。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/lsws/conf
<span class="token function">wget</span> https://waf.comodo.com/api/cpanel_litespeed_vendor
<span class="token function">unzip</span> cpanel_litespeed_vendor
<span class="token builtin class-name">cd</span> comodo_litespeed/
<span class="token function">mv</span> rules.conf.main rules.conf
</code></pre></div><p>上述步骤下载了 Comodo Litespeed 规则，并重命名 <code>rules.conf.main</code>为<code>rules.conf</code>。这是包含所有规则的主文件。我们可以在WebAdmin控制台中引用此主文件。</p> <h2 id="添加waf规则集">添加WAF规则集</h2> <p>导航到 <strong>Configuration &gt; Server &gt; Security &gt; WAF Rule Set</strong></p> <p><img src="https://pics.mf8.biz/picgo20190225145936.png" alt=""></p> <p>单击 <strong>ADD</strong> 以编辑 <strong>WAF规则集</strong>。</p> <p><img src="https://pics.mf8.biz/picgo20190225150228.png" alt=""></p> <ul><li><strong>Name</strong>: <code>Comodo Litespeed</code></li> <li><strong>Action</strong>: <code>None</code></li> <li><strong>Enabled</strong>: <code>Yes</code></li> <li><strong>Rules Definition</strong>: <code>Include $SERVER_ROOT/conf/comodo_litespeed/rules.conf</code></li></ul> <p>单击  <strong>Save</strong> 以激活规则。</p> <p>可以在 <strong>Rules Definition</strong> 区域中包含任意数量的规则文件。</p> <p>我们输入的文件 <code>rules.conf</code> 是 Comodo 主文件，按顺序包含所有规则。它与手动输入以下内容相同（需要再加上文件所在物理路径前缀）：</p> <div class="language- extra-class"><pre class="language-text"><code>Include 00_Init_Initialization.conf
Include 01_Init_AppsInitialization.conf
Include 02_Global_Generic.conf
Include 03_Global_Agents.conf
Include 04_Global_Domains.conf
Include 05_Global_Incoming.conf
Include 06_Global_Backdoor.conf
Include 07_XSS_XSS.conf
Include 08_Global_Other.conf
Include 09_Bruteforce_Bruteforce.conf
Include 10_HTTP_HTTP.conf
Include 11_HTTP_HTTPDoS.conf
Include 12_HTTP_Protocol.conf
Include 13_HTTP_Request.conf
Include 14_Outgoing_FilterGen.conf
Include 15_Outgoing_FilterASP.conf
Include 16_Outgoing_FilterPHP.conf
Include 17_Outgoing_FilterSQL.conf
Include 18_Outgoing_FilterOther.conf
Include 19_Outgoing_FilterInFrame.conf
Include 20_Outgoing_FiltersEnd.conf
Include 21_PHP_PHPGen.conf
Include 22_SQL_SQLi.conf
Include 23_ROR_RORGen.conf
Include 24_Apps_Joomla.conf
Include 25_Apps_JComponent.conf
Include 26_Apps_WordPress.conf
Include 27_Apps_WPPlugin.conf
Include 28_Apps_WHMCS.conf
Include 29_Apps_Drupal.conf
Include 30_Apps_OtherApps.conf
</code></pre></div><p>如果使用一些商业规则集（如Atomic规则集）或您自己的规则集（没有这样的主文件），您有两个选择：</p> <ul><li>在“ <strong>Rules Definition”<strong>字段中逐个包含绝对路径的</strong>规则</strong>。</li> <li>创建一个主文件以包含具有完整路径的所有规则，然后在“ **Rules Definition”**字段中仅包含该主文件。</li></ul> <p>如果包含mod_security的多个rul文件，则必须按正确的顺序包含这些文件，以使它们正常工作。</p> <h2 id="启用防火墙">启用防火墙</h2> <p>导航到<strong>Configuration &gt; Server &gt; Security &gt; Web Application Firewall (WAF)</strong></p> <p><img src="https://pics.mf8.biz/picgo20190225150703.png" alt=""></p> <ul><li><strong>Enable WAF</strong>: <code>Yes</code></li> <li><strong>Log Level</strong>: <code>0</code></li> <li><strong>Default Action</strong>: <code>deny,log,status:403</code></li> <li><strong>Scan Request Body</strong>: <code>Yes</code> (If set to <code>Yes</code> will scan post request body)</li> <li><strong>Temporary File Path</strong>: <code>/tmp</code></li> <li><strong>Disable .htaccess Override</strong>: <code>Not Set</code></li> <li><strong>Enable Security Audit Log</strong>: <code>Not Set</code></li> <li><strong>Security Audit Log</strong>: <code>$SERVER_ROOT/logs/security_audit.log</code></li></ul> <p>单击“ **Save”**以启用防火墙，然后执行 “<strong>Graceful Restart.</strong>” 即 重启 LiteSpeed。</p> <h2 id="测试modsecurity规则集">测试ModSecurity规则集</h2> <h3 id="方法1">方法1</h3> <p>要检查CWAF是否有保护，请发送此请求：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>http://<span class="token variable">$server_domain</span>/?a<span class="token operator">=</span>b AND <span class="token assign-left variable">1</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><p>如果它正常工作，服务器应该响应403状态代码。</p> <p><img src="https://pics.mf8.biz/picgo20190225151248.png" alt=""></p> <h3 id="方法2：">方法2：</h3> <p>您可以通过发送GET或POST请求参数来检查CWAF是否正常工作 <code>cwaf_test_request=a12875a9e62e1ecbcd1dded1879ab06949566276</code></p> <p>像这样：</p> <div class="language- extra-class"><pre class="language-text"><code>http://$server_domain/?cwaf_test_request=a12875a9e62e1ecbcd1dded1879ab06949566276
</code></pre></div><p>如果Web服务器返回403 Forbidden状态，则CWAF正常工作。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com//LLStack/Docs/edit/master/lsws/LiteSpeed/waf.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lsws/LiteSpeed/Activation.html" class="prev">
        LiteSpeed 激活
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.a453011c.js" defer></script><script src="/assets/js/2.25f4805c.js" defer></script><script src="/assets/js/13.d814101e.js" defer></script><script src="/assets/js/3.a091ac96.js" defer></script>
  </body>
</html>
